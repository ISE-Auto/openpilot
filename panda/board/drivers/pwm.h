#define PWMCH0 1
#define PWMCH1 2
#define PWMCH2 3

void pwm_init(void)
{
    // setup PA0, PA1, PA2 for PWM
    GPIOA->MODER |= GPIO_MODER_MODE1_1 | GPIO_MODER_MODE2_1 | GPIO_MODER_MODE3_1;
    GPIOA->AFR[0] = GPIO_AF1_TIM2 << (PWMCH0 * 4) | GPIO_AF1_TIM2 << (PWMCH1 * 4) | GPIO_AF1_TIM2 << (PWMCH2 * 4);
    TIM2->ARR = 2000;
    TIM2->CCMR1 |= (TIM_CCMR1_OC2M_0 | TIM_CCMR1_OC2M_1 | TIM_CCMR1_OC2M_2);
    TIM2->CCMR2 |= (TIM_CCMR2_OC3M_0 | TIM_CCMR2_OC3M_1 | TIM_CCMR2_OC3M_2 | TIM_CCMR2_OC4M_0 | TIM_CCMR2_OC4M_1 | TIM_CCMR2_OC4M_2);
    TIM2->CCER |= (TIM_CCER_CC2E | TIM_CCER_CC3E | TIM_CCER_CC4E);
}